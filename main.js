(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"90146057-36cb-4eda-a113-616a7fa7d2dd","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))},n=document.querySelector(".button_target_edit-profile"),o=document.querySelector(".button_target_add-card"),r=(document.querySelector(".button_target_save"),document.querySelector(".button_target_edit-avatar")),a=document.querySelectorAll(".popup"),c=document.querySelector(".popup_for_edit-avatar"),u=document.querySelector(".popup_for_edit-profile"),i=document.querySelector(".popup_for_add-place"),l=document.querySelector(".popup_for_big-picture"),s=document.querySelector(".popup__image"),d=document.querySelector(".popup__image-name"),f=(document.querySelector(".popup_for_error"),document.querySelector(".profile__info-username")),p=document.querySelector(".profile__info-about-user"),_=document.querySelector(".profile__avatar"),m=(document.querySelector(".form"),document.querySelector("#form-edit-profile")),v=document.querySelector("#form-add-place"),h=document.querySelector("#form-edit-avatar"),g=(document.querySelector("#form-error"),document.querySelector(".form__input-name")),y=document.querySelector(".form__input-about"),b=document.querySelector(".form__input-place"),S=document.querySelector(".form__input-link"),q=document.querySelector(".form__input-avatar"),L=document.querySelector(".places__list"),C={formSelector:".popup__form",inputSelector:".form__input",submitButtonSelector:".button_target_save",inactiveButtonClass:"button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"};function k(e){"Escape"===e.key&&x(document.querySelector(".popup_status_opened"))}var E=function(e){document.addEventListener("keydown",k),e.classList.add("popup_status_opened")},x=function(e){document.removeEventListener("keydown",k),e.classList.remove("popup_status_opened")},A=function(e){var t=e.querySelector(".button_target_save");t.hasAttribute("disabled")?(t.classList.remove(C.inactiveButtonClass),t.removeAttibute("disabled")):(t.classList.add(C.inactiveButtonClass),t.setAttribute("disabled",!0))};function N(e,t,n){var o=t.querySelector(".button_target_save");e?(o.classList.add("button_loading"),o.textContent=""):(o.classList.remove("button_loading"),o.textContent=n)}var U,B=function(n,o,r,a,c,u){var i=document.querySelector("#place").content.querySelector(".place").cloneNode(!0),f=i.querySelector(".place__image"),p=i.querySelector(".place__count-like"),_=i.querySelector(".button_target_delete"),m=i.querySelector(".button_target_like");return i.querySelector(".place__name").textContent=n,f.setAttribute("src",o),f.setAttribute("alt",n),r.length>0&&r.forEach((function(e){u===e._id&&m.classList.toggle("button_target_like-active")})),function(e,t){var n=57;if(void 0!==t){if(0!==t.length)switch(t.length.toString().length){case 2:e.textContent=t.length,n-=4,e.style.left="".concat(n,"px");break;case 3:e.textContent=t.length,n-=8,e.style.left="".concat(n,"px");break;case 4:e.textContent=t.length,n-=12,e.style.left="".concat(n,"px");break;default:e.textContent=t.length}else 0===t.length&&e.classList.add("place__count-like_unvisible");e.textContent=t.length}}(p,r),u===a?_.addEventListener("click",(function(n){var o;(o=c,fetch("".concat(e.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:e.headers})).then(t,n.target.closest(".place").remove()).catch((function(e){console.log(e)}))})):_.style.display="none",f.addEventListener("click",(function(e){s.src=e.target.src,s.alt=e.target.alt,d.textContent=s.alt,E(l)})),m.addEventListener("click",(function(n){var o;n.target.className.includes("button_target_like-active")?function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers})}(c).then(t).then((function(e){0===e.likes.length&&(p.classList.add("place__count-like_unvisible"),n.target.classList.remove("button_target_like-active")),p.textContent=e.likes.length,n.target.classList.remove("button_target_like-active")})).catch((function(e){console.log(e)})):(o=c,fetch("".concat(e.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:e.headers})).then(t).then((function(e){n.target.classList.add("button_target_like-active"),p.classList.remove("place__count-like_unvisible"),p.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),i},T=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(C.inactiveButtonClass),t.removeAttribute("disabled",!1)):(t.classList.add(C.inactiveButtonClass),t.setAttribute("disabled",!0))},D=function(e){e.className.includes("popup_for_big-picture")||(e.querySelector(".form").reset(),e.querySelectorAll(".form__input-error").forEach((function(e){e.textContent="",e.classList.remove(C.errorClass)})),e.querySelectorAll(C.inputSelector).forEach((function(e){e.classList.remove(C.inputErrorClass)})))};fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t).then((function(n){var o=n._id;f.textContent=n.name,p.textContent=n.about,_.setAttribute("src","".concat(n.avatar)),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t).then((function(e){!function(e,t,n){e.forEach((function(e){t.append(B(e.name,e.link,e.likes,e.owner._id,e._id,n))}))}(e,L,o)})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})),a.forEach((function(e){return e.addEventListener("click",(function(t){t.target.className.includes("button_target_closed")?x(e):"popup__heading"===t.target.className||"popup__image"===t.target.className?t.stopPropagation():t.target.className.includes("popup")&&x(e)}))})),h.addEventListener("submit",(function(n){var o;n.preventDefault(),(o=q.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})})).then(t,N(!0,n.target)).then((function(e){_.setAttribute("src","".concat(e.avatar))})).catch((function(e){console.log(e)})).finally((function(e){N(!1,n.target,"Обновить"),x(c),A(n.target)}))})),m.addEventListener("submit",(function(n){n.preventDefault(),function(t,n){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t,about:n})})}(g.value,y.value).then(t,N(!0,n.target)).then((function(e){f.textContent=e.name,p.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(e){N(!1,n.target,"Сохранить"),x(u),A(n.target)}))})),v.addEventListener("submit",(function(n){var o,r;n.preventDefault(),(o=b.value,r=S.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:o,link:r})})).then(t,N(!0,n.target)).then((function(e){L.prepend(B(e.name,e.link,e.likes,e.owner._id,e._id))})).catch((function(e){console.log(e)})).finally((function(e){N(!1,n.target,"Добавить"),x(i),A(n.target)}))})),n.addEventListener("click",(function(){D(u),g.value=f.textContent,y.value=p.textContent,E(u)})),o.addEventListener("click",(function(){D(i),E(i)})),r.addEventListener("click",(function(){D(c),E(c)})),U=C,Array.from(document.querySelectorAll(U.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(C.inputSelector)),n=e.querySelector(C.submitButtonSelector);T(t,n),t.forEach((function(o){o.addEventListener("input",(function(){(function(e,t){t.validity.valid?function(e,t){t.classList.remove(C.inputErrorClass);var n=e.querySelector(".".concat(t.id,"-error"));n.textContent="",n.classList.remove(C.errorClass)}(e,t):function(e,t,n){t.classList.add(C.inputErrorClass);var o=e.querySelector(".".concat(t.id,"-error"));o.textContent=n,o.classList.add(C.errorClass)}(e,t,t.validationMessage)})(e,o),T(t,n)}))}))}(e)}))})();